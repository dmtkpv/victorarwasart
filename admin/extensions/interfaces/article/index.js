function e(){tinymce.PluginManager.add("reference",(function(e){const t=e.getParam("referenceDialog");function n(){return e.dom.getParent(e.selection.getNode(),"[data-reference]")}function r({name:e="",image:t="",text:n=""}){return`<span id="${"ref"+Math.random().toString(36).substr(2,9)}" data-reference data-image="${t}" data-text="${n}">${e}</span>`}function a(){const t=new Event("input");e.dom.select("body")[0].dispatchEvent(t)}t.$on("save",(t=>{const i=n();i?e.dom.remove(i):function(){const t=e.selection.getContent().match(/<span id="[^"]+" data-reference/g);t&&t.forEach((t=>e.dom.remove(t.match(/id="([^"]+)"/)[1])))}(),e.selection.setContent(r(t)),a()})),t.$on("delete",(()=>{const t=n();e.dom.remove(t),e.selection.setContent(t.textContent),a()})),e.ui.registry.addToggleButton("reference",{text:"Note",onAction:function(){let r={};const a=n();a?r=function(e){return{name:e.textContent,image:e.getAttribute("data-image"),text:e.getAttribute("data-text")}}(a):r.name=e.selection.getContent({format:"text"}),t.set(r)},onSetup(t){e.on("NodeChange",(()=>{t.setActive(null!==n())}))}})}))}var t=[],n=[];function r(e,r){if(e&&"undefined"!=typeof document){var a,i=!0===r.prepend?"prepend":"append",o=!0===r.singleTag,s="string"==typeof r.container?document.querySelector(r.container):document.getElementsByTagName("head")[0];if(o){var c=t.indexOf(s);-1===c&&(c=t.push(s)-1,n[c]={}),a=n[c]&&n[c][i]?n[c][i]:n[c][i]=d()}else a=d();65279===e.charCodeAt(0)&&(e=e.substring(1)),a.styleSheet?a.styleSheet.cssText+=e:a.appendChild(document.createTextNode(e))}function d(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),r.attributes)for(var t=Object.keys(r.attributes),n=0;n<t.length;n++)e.setAttribute(t[n],r.attributes[t[n]]);var a="prepend"===i?"afterbegin":"beforeend";return s.insertAdjacentElement(a,e),e}}function a(e,t,n,r,a,i,o,s,c,d){"boolean"!=typeof o&&(c=s,s=o,o=!1);const l="function"==typeof n?n.options:n;let u;if(e&&e.render&&(l.render=e.render,l.staticRenderFns=e.staticRenderFns,l._compiled=!0,a&&(l.functional=!0)),r&&(l._scopeId=r),i?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(i)},l._ssrRegister=u):t&&(u=o?function(e){t.call(this,d(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,s(e))}),u)if(l.functional){const e=l.render;l.render=function(t,n){return u.call(n),e(t,n)}}else{const e=l.beforeCreate;l.beforeCreate=e?[].concat(e,u):[u]}return n}r("\n.image[data-v-850aab50] {\n    position: relative;\n    height: var(--input-height-tall);\n    border-radius: var(--border-radius);\n    overflow: hidden;\n}\n.image img[data-v-850aab50] {\n    width: 100%;\n    height: 100%;\n    object-fit: cover;\n}\n.image .overlay[data-v-850aab50] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    background: linear-gradient(180deg, rgba(38, 50, 56, 0), rgba(38, 50, 56, .25));\n    opacity: 0;\n    transform: translateY(10px);\n    transition: var(--medium) var(--transition);\n    transition-property: opacity transform;\n}\n.image .overlay .v-button[data-v-850aab50] {\n    --v-button-color: var(--foreground-subdued);\n    --v-button-background-color: var(--white);\n    --v-button-color-hover: var(--foreground-normal);\n    --v-button-background-color-hover: var(--white);\n}\n.image .overlay[data-v-850aab50]:hover {\n    transform: translateY(0);\n    opacity: 1;\n}\n\n",{});const i={props:["image"]};var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"image"},[n("img",{attrs:{src:"/assets/"+e.image}}),e._v(" "),n("div",{staticClass:"overlay"},[n("v-button",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.$t("deselect"),expression:"$t('deselect')"}],attrs:{icon:"",rounded:""},on:{click:function(t){return e.$emit("deselect")}}},[n("v-icon",{attrs:{name:"close"}})],1)],1)])};o._withStripped=!0;var s={components:{imagePreview:a({render:o,staticRenderFns:[]},undefined,i,"data-v-850aab50",false,undefined,!1,void 0,void 0,void 0)},data:()=>({reference:!1,canDelete:!1}),computed:{canSave(){return this.reference&&this.reference.name&&(this.reference.image||this.reference.text)}},methods:{set(e){this.reference=e,this.canDelete=this.canSave},setImage(e){e?this.$set(this.reference,"image",e.id):this.$delete(this.reference,"image")},save(){this.$emit("save",this.reference),this.set(!1)},del(){this.$emit("delete",this.reference),this.set(!1)}}};r("\n.v-button.delete[data-v-67c6481e] {\n    --v-button-background-color: var(--danger-25);\n    --v-button-color: var(--danger);\n    --v-button-background-color-hover: var(--danger-50);\n    --v-button-color-hover: var(--danger);\n}\n\n",{});const c=s;var d=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-dialog",{attrs:{active:e.reference},on:{toggle:function(t){return e.set(!1)},esc:function(t){return e.set(!1)}}},[n("v-card",[n("v-card-title",[e._v("Note")]),e._v(" "),n("v-card-text",[n("v-input",{attrs:{placeholder:"Text"},model:{value:e.reference.name,callback:function(t){e.$set(e.reference,"name",t)},expression:"reference.name"}})],1),e._v(" "),e.reference.image?n("v-card-text",[n("image-preview",{attrs:{image:e.reference.image},on:{deselect:function(t){return e.setImage(!1)}}})],1):n("v-card-text",[n("v-upload",{attrs:{"from-library":""},on:{input:e.setImage}})],1),e._v(" "),n("v-card-text",[n("v-textarea",{attrs:{placeholder:"Description"},model:{value:e.reference.text,callback:function(t){e.$set(e.reference,"text",t)},expression:"reference.text"}})],1),e._v(" "),n("v-card-actions",[n("v-button",{staticClass:"delete",attrs:{disabled:!e.canDelete},on:{click:e.del}},[e._v("Delete")]),e._v(" "),n("v-button",{staticClass:"save",attrs:{disabled:!e.canSave},on:{click:e.save}},[e._v("Save")])],1)],1)],1)};d._withStripped=!0;const l={props:["value"],data:()=>({loading:!1,editor:null,content:null}),components:{referenceDialog:a({render:d,staticRenderFns:[]},undefined,c,"data-v-67c6481e",false,undefined,!1,void 0,void 0,void 0)},methods:{load(){return new Promise((e=>{if(window.tinymce)return e();this.loading=!0;const t=new MutationObserver((n=>{window.tinymce&&(t.disconnect(),this.loading=!1,e())}));t.observe(this.$el,{childList:!0})}))},init(){e(),tinymce.init({skin:!1,skin_url:!1,content_css:!1,target:this.$refs.target,menubar:!1,statusbar:!1,contextmenu:!1,plugins:"reference link",toolbar:"reference link",content_style:"[data-reference] { color: #f2994a; text-decoration: underline; }",referenceDialog:this.$refs.reference,setup:this.setup})},setup(e){this.editor=e,this.editor.on("init",(e=>{this.editor.setContent(this.value||"")})),this.editor.on("input",(t=>{this.content=e.getContent()}))}},watch:{value(e){e!==this.content&&this.editor&&this.editor.setContent(e||"")},content(e){this.$emit("input",e)}},async mounted(){await this.load(),this.init()}};var u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("interface-wysiwyg"),e._v(" "),n("textarea",{ref:"target"}),e._v(" "),n("reference-dialog",{ref:"reference"})],1)};u._withStripped=!0;var v={component:a({render:u,staticRenderFns:[]},undefined,l,undefined,false,undefined,!1,void 0,void 0,void 0),id:"article",name:"Article",description:"A custom text editor with references",icon:"subject",types:["text"]};export default v;
