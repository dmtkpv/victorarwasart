<!--
    Styles
-->

<style lang="scss">



    // --------------------
    // Nav
    // --------------------

    .l-nav {

        @extend %col;
        @include md-xl { padding: $indent-y $indent-x; }

        @include sm {

            position: absolute;
            top: 0;
            width: 100%;

            &:not(.transparent) { background: $black; }
            &:not(.transparent) + * { padding-top: 60px; }
            &.transparent .l-nav-head.primary { border-bottom: none }

        }


    }



    // --------------------
    // Menu
    // --------------------

    .l-nav-menu {

        @include md-xl {
            display: block !important;
        }

        @include sm {
            @include stretch;
            position: fixed;
            background: $black;
        }

    }


</style>



<!--
    Template
-->

<template>
    <nav class="l-nav">

        <nav-head primary @toggle="toggle(true)" />

        <div class="l-nav-menu" v-show="opened">
            <nav-head @toggle="toggle(false)" />
            <nav-item v-for="(link, i) in nav" v-bind="link" :key="i" />
            <nav-search />
        </div>

    </nav>
</template>



<!--
    Scripts
-->

<script>

    import fix from '$mixins/mixin.fix'
    import scrollSet from '$mixins/mixin.scroll.set'
    import navHead from './nav.head'
    import navItem from './nav.item'
    import navSearch from './nav.search'

    export default {

        components: {
            navHead,
            navItem,
            navSearch
        },

        mixins: [
            scrollSet('nav', 'opened'),
            fix({
                minTop () { return -this.getHeight('$nav') - this.getHeight('$header') },
                maxTop () { return 0 }
            })
        ],

        data () {
            return {
                opened: false
            }
        },

        computed: {

            nav () {
                return this.$store.getters['layout/nav']
            }

        },

        methods: {

            toggle (value) {
                this.opened = value;
            }

        },

        watch: {

            '$route.path' () {
                this.opened = false;
            },

            opened () {
                this.fixNormalize();
            }

        },

        serverPrefetch () {
            return Promise.all([
                this.$store.dispatch('request', 'count'),
                this.$store.dispatch('request', 'filter/movements'),
                this.$store.dispatch('request', 'filter/types'),
                this.$store.dispatch('request', 'filter/publications')
            ])
        }

    }

</script>
